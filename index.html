<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简易记帐</title>
    <script src="./moment.min.js"></script>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        text-align: center;
        font-family: 'Courier New', Courier, monospace;
        font-size: 1.5rem;
    }

    body {
        margin-top: 3rem;
        margin-bottom: 2rem;
    }

    h1,
    h2 {
        margin: auto;
        margin-bottom: 1rem;
        width: 5rem;
    }

    .line {
        display: flex;
        justify-content: center;
    }

    button {
        background-color: transparent;
        border: transparent;
        width: 4rem;
        height: 2.5rem;
    }

    button:active {
        background-color: aliceblue;
    }

    ul li {
        font-size: 0.7rem;
        margin-bottom: 0.5rem;
    }

    ul {
        margin-bottom: 2rem;
    }
</style>

<body>
    <ul>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
    <h1>0</h1>
    <h2>_</h2>
    <div class="line">
        <button id="K7">7</button>
        <button id="K8">8</button>
        <button id="K9">9</button>
    </div>
    <div class="line">
        <button id="K4">4</button>
        <button id="K5">5</button>
        <button id="K6">6</button>
    </div>
    <div class="line">
        <button id="K1">1</button>
        <button id="K2">2</button>
        <button id="K3">3</button>
    </div>
    <div class="line">
        <button id="KD">.</button>
        <button id="K0">0</button>
        <button id="KO">OK</button>
    </div>
    <script>
        const lis = document.querySelectorAll('li')
        const h1 = document.querySelector('h1')
        const h2 = document.querySelector('h2')
        const K1 = document.querySelector('#K1')
        const K2 = document.querySelector('#K2')
        const K3 = document.querySelector('#K3')
        const K4 = document.querySelector('#K4')
        const K5 = document.querySelector('#K5')
        const K6 = document.querySelector('#K6')
        const K7 = document.querySelector('#K7')
        const K8 = document.querySelector('#K8')
        const K9 = document.querySelector('#K9')
        const K0 = document.querySelector('#K0')
        const KD = document.querySelector('#KD')
        const KO = document.querySelector('#KO')
        h1.addEventListener('click', clearAll)
        h2.addEventListener('click', backspace)
        K1.addEventListener('click', b1)
        K2.addEventListener('click', b2)
        K3.addEventListener('click', b3)
        K4.addEventListener('click', b4)
        K5.addEventListener('click', b5)
        K6.addEventListener('click', b6)
        K7.addEventListener('click', b7)
        K8.addEventListener('click', b8)
        K9.addEventListener('click', b9)
        K0.addEventListener('click', b0)
        KD.addEventListener('click', bD)
        KO.addEventListener('click', bO)
        function b1() { str = str + K1.innerHTML; h2.innerHTML = str }
        function b2() { str = str + K2.innerHTML; h2.innerHTML = str }
        function b3() { str = str + K3.innerHTML; h2.innerHTML = str }
        function b4() { str = str + K4.innerHTML; h2.innerHTML = str }
        function b5() { str = str + K5.innerHTML; h2.innerHTML = str }
        function b6() { str = str + K6.innerHTML; h2.innerHTML = str }
        function b7() { str = str + K7.innerHTML; h2.innerHTML = str }
        function b8() { str = str + K8.innerHTML; h2.innerHTML = str }
        function b9() { str = str + K9.innerHTML; h2.innerHTML = str }
        function b0() { str = str + K0.innerHTML; h2.innerHTML = str }
        function bD() { str = str + KD.innerHTML; h2.innerHTML = str }
        let str = ''
        let arr = [
            ['total',]
        ]
        function date() {
            let now = moment().format("M.D HH:MM");
            return now
        }
        function backspace() {
            if (h2.innerHTML.length == 1) {
                str = ''
                h2.innerHTML = '_'
                return
            }
            str = str.slice(0, str.length - 1)
            h2.innerHTML = str
        }
        function bO() {
            if (str == 0) {
                clearH2()
                return
            }

            arr.push([date(), str])
            h1.innerHTML = sum()
            clearH2()
            updateList()
            saveData()
            console.table(arr)
        }
        function sum() {
            let sum = 0
            for (let i = 1; i < arr.length; i++) {
                sum += Number(arr[i][1])
            }
            arr[0][1] = sum.toFixed(1)
            return arr[0][1]
        }
        function clearH2() {
            str = ''
            h2.innerHTML = '_'
        }
        function clearAll() {
            if (confirm('清空？')) {
                localStorage.clear()
                arr = [
                    ['total',]
                ]
                str = ''
                h1.innerHTML = '0'
                h2.innerHTML = '_'
                for (const li of lis) {
                    li.innerHTML = ''
                }
            }
        }
        function updateList() {
            switch (arr.length) {
                case 1:
                    return
                case 2:
                    lis[5].innerHTML = arr[1][0] + "=>" + arr[1][1]
                    break;
                case 3:
                    lis[5].innerHTML = arr[2][0] + "=>" + arr[2][1]
                    lis[4].innerHTML = arr[1][0] + "=>" + arr[1][1]
                    break;
                case 4:
                    lis[5].innerHTML = arr[3][0] + "=>" + arr[3][1]
                    lis[4].innerHTML = arr[2][0] + "=>" + arr[2][1]
                    lis[3].innerHTML = arr[1][0] + "=>" + arr[1][1]
                    break;
                case 5:
                    lis[5].innerHTML = arr[4][0] + "=>" + arr[4][1]
                    lis[4].innerHTML = arr[3][0] + "=>" + arr[3][1]
                    lis[3].innerHTML = arr[2][0] + "=>" + arr[2][1]
                    lis[2].innerHTML = arr[1][0] + "=>" + arr[1][1]
                    break;
                case 6:
                    lis[5].innerHTML = arr[5][0] + "=>" + arr[5][1]
                    lis[4].innerHTML = arr[4][0] + "=>" + arr[4][1]
                    lis[3].innerHTML = arr[3][0] + "=>" + arr[3][1]
                    lis[2].innerHTML = arr[2][0] + "=>" + arr[2][1]
                    lis[1].innerHTML = arr[1][0] + "=>" + arr[1][1]
                    break;
                default:
                    let nArr = arr.slice(arr.length - 6)
                    for (let i = 0; i < lis.length; i++) {
                        lis[i].innerHTML = nArr[i][0] + '=>' + nArr[i][1]
                    }
                    break;
            }
        }
        function saveData() {
            localStorage.clear()
            arr.forEach((item, index) => {
                localStorage.setItem(index, item)
            });
        }
        function loadData() {
            for (let i = 0; i < localStorage.length; i++) {
                arr[i] = localStorage[i].split(',')
            }
        }
        ; (function () {
            loadData()
            updateList()
            h1.innerHTML = arr[0][1] || 0
        })()
    </script>
</body>

</html>